# Ansible Role: common（サーバ初期設定共通ロール）

このロールは、Linux サーバの初期セットアップに必要な **共通処理を標準化・自動化** するために設計されています。運用現場において「**保守性・再利用性・拡張性**」を重視し、以下の設計思想に基づいて構築されています。

---

## 設計・ポリシー

### 1. Block化による可読性と拡張性

- すべてのタスクは `block` 構文で構成されており、目的ごとにまとめられています。
- 条件分岐やタグの適用がしやすく、今後の機能追加・差分適用にも強い構造です。

### 2. 設定ファイルはすべて Jinja2 テンプレート化（`.j2`）

- `sshd_config` や `chrony.conf` などの設定ファイルはすべて `.j2` テンプレート形式で管理。
- 変数ベースで動的に生成することで、**異なる環境（要件等）やOSバージョン間の差異に柔軟対応**。
- 構成ファイルのバージョン管理も容易になります。

### 3. 変数化の徹底

- パッケージ一覧・ファイアウォールポート・SSH設定などはすべて `defaults` または `group_vars` で定義。
- ロール自体のコードを触らずに、環境に応じたvars fileを変えられるように設計。

### 4. 冪等性と安全性の考慮

- `authorized_key` モジュールによる SSH 公開鍵の導入、SELinux 無効化のための `replace` 処理、chrony の `template` 適用など、**全ての処理が冪等であり、安全な差分反映が可能**です。
- SSH 設定変更後は `sshd` の再起動を handler によって制御。

---

## 主な機能（tasks）

- 必要ツールの一括インストール（`vim`, `curl`, `traceroute` など）
- `ops` ユーザーの作成＋SSH鍵設定
- SELinux の無効化
- firewalld の導入と基本ポートの開放
- NTP（chrony）設定と時刻同期
- SSH設定のセキュア化（root/PW ログインの無効化、公開鍵ログイン限定）

---

## 想定環境

- Rocky Linux 8/9
- CentOS 8
- RHEL 8/9　今後検討
- Debian/Ubuntu 系への対応は今後検討

---

## その他
- ｀ops｀公開鍵設定
ssh-keygen -t rsa -b 4096 -C "ops key" -f ~/.ssh/ops_id_rsa
